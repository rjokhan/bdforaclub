{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>События</title>
    <link rel="stylesheet" href="{% static 'base.css' %}">
    <link rel="stylesheet" href="{% static 'events.css' %}">
    <script src="{% static 'core/events.js' %}" defer></script>
    <script src="{% static 'core/purchase.js' %}" defer></script>

    <style>
        .popup {
            position: fixed;
            top: 10vh;
            left: 50%;
            transform: translateX(-50%);
            width: 80vw;
            height: 80vh;
            background: #ffffff;
            color: #1f1f1f;
            z-index: 9999;
            border-radius: 16px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.35);
            display: flex;
            flex-direction: column;
            padding: 32px;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }

        .popup-content {
            position: relative;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .popup h2 {
            margin: 0 0 20px 0;
            font-size: 24px;
            font-weight: 700;
            border-bottom: 1px solid #e5e5e5;
            padding-bottom: 12px;
        }

        .events-scroll {
            overflow-y: auto;
            flex: 1;
            padding-right: 10px;
        }

        .participant-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 12px;
            align-items: center;
            padding: 14px;
            border-bottom: 1px solid #eee;
        }

        .status-chip {
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            display: inline-block;
            width: 100px;
        }

        .status-chip.green {
            background-color: #dcfce7;
            color: #166534;
        }

        .status-chip.yellow {
            background-color: #fef9c3;
            color: #92400e;
        }

        .status-chip.red {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .toggle-group {
            display: flex;
            gap: 4px;
        }

        .toggle-group button {
            padding: 6px 10px;
            opacity: 0.3;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: #f1f1f1;
            font-size: 16px;
        }

        .toggle-group button.active {
            opacity: 1;
            background: #e0e7ff;
        }

        .popup .close-btn {
            position: absolute;
            top: 16px;
            right: 20px;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
            transition: color 0.2s;
        }

        .popup .close-btn:hover {
            color: #e11d48;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="vertical-waves">
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
    </div>

    <h1>Список событий</h1>
    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
        <button onclick="openEventPopup()">Добавить событие</button>
        <button onclick="openPurchasePopup()">Добавить покупку</button>
    </div>

    <table id="eventsTable">
        <thead>
            <tr>
                <th>№</th>
                <th>Название</th>
                <th>Дата</th>
                <th>Стоимость</th>
                <th>Всего мест</th>
                <th>Куплено</th>
                <th>Свободно</th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- Попап: Добавление события -->
    <div id="event-popup-overlay" style="display: none;">
        <div id="popup">
            <h3>Новое событие</h3>
            <input id="eventNameInput" placeholder="Название">
            <input id="eventDateInput" type="date" placeholder="Дата">
            <input id="eventSeatsInput" type="number" placeholder="Всего мест">
            <input id="eventPriceInput" type="number" placeholder="Стоимость">
            <button onclick="addEvent()">Сохранить</button>
            <button onclick="closeEventPopup()">Закрыть</button>
        </div>
    </div>

    <!-- Попап: Завершение/активация -->
    <div id="popup-overlay" style="display: none;">
        <div id="popup-confirm">
            <p id="confirm-message">Вы уверены?</p>
            <div class="popup-buttons">
                <button id="confirm-yes">Да</button>
                <button id="confirm-no">Нет</button>
            </div>
        </div>
    </div>

    <!-- Попап: Добавить покупку -->
    <div id="purchase-popup-overlay" style="display: none;">
        <div id="purchase-popup">
            <div id="purchase-step-event">
                <h3>Выберите ивент</h3>
                <div id="event-list-container"></div>
            </div>

            <div id="purchase-step-residents" style="display: none;">
                <h3>Выберите резидентов</h3>
                <input type="text" id="resident-search-input" placeholder="Поиск по ФИО или номеру...">
                <button onclick="searchResidents()">Поиск</button>
                <div id="resident-search-results"></div>

                <h4>Выбранные резиденты:</h4>
                <div id="selected-residents-list"></div>

                <button id="save-purchase-button" style="display: none;" onclick="savePurchases()">Сохранить</button>
            </div>

            <button onclick="closePurchasePopup()" style="margin-top: 15px;">Закрыть</button>
        </div>
    </div>

    <!-- Попап: Участники события -->
    <div id="eventParticipantsPopup" class="popup hidden">
        <div class="popup-content">
            <span class="close-btn" onclick="closeParticipantsPopup()">×</span>
            <h2>Участники события</h2>
            <div id="participantsList" class="events-scroll"></div>
        </div>
    </div>
</body>
</html>
